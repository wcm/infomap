(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{131:function(t,e,a){},144:function(t,e,a){t.exports=a(300)},149:function(t,e,a){},157:function(t,e,a){},221:function(t,e,a){},236:function(t,e){},238:function(t,e){},249:function(t){t.exports={"Nolli Map":{title:"Coloring Mode:",options:["None","Height","Program"]},Traffic:{title:"Display:",options:["Both","Roads","Public Transport"]},Overlay:{title:"Options:",options:[]}}},292:function(t,e,a){},297:function(t,e,a){},300:function(t,e,a){"use strict";a.r(e);var n=a(0),i=a.n(n),o=a(40),s=a.n(o),r=a(306),l=a(155);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=a(5),p=a(4),h=a(8),d=a(6),u=a(7),m=a(152),g=a(302),f=(a(149),function(t){function e(){return Object(c.a)(this,e),Object(h.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return i.a.createElement("div",{className:"navbar-wrapper"},i.a.createElement("div",{className:"navbar-logo"},i.a.createElement(m.a,{to:"/infomap/"},i.a.createElement("img",{style:{height:40},src:"/infomap/image/logo.svg",alt:"Infomap Logo"}))),i.a.createElement("div",{className:"navbar-tabs"},i.a.createElement(g.a,{className:"navbar-tabitem",activeClassName:"navbar-tabitem-active",to:"/infomap/about"},"About"),i.a.createElement(g.a,{className:"navbar-tabitem",activeClassName:"navbar-tabitem-active",to:"/infomap/help"},"Help")))}}]),e}(i.a.Component)),v=(a(157),a(89)),b=a(62),y=a(140),w=a.n(y),E=a(305),k=a(26),M=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(h.a)(this,Object(d.a)(e).call(this,t))).updateWindowDimensions=function(){a.setState({width:.9*window.innerWidth})},a.updateXY=function(t,e,n){var i=n.deltaX,o=n.deltaY;"1"===t?a.props.x+i>=40&&a.props.x+i<=a.state.width/2-40&&a.props.y+o>=60&&a.props.y+o<=a.state.height/2-40&&a.props.setXY({x:a.props.x+i,y:a.props.y+o}):"2"===t?a.props.x-i>=40&&a.props.x-i<=a.state.width/2-40&&a.props.y+o>=60&&a.props.y+o<=a.state.height/2-40&&a.props.setXY({x:a.props.x-i,y:a.props.y+o}):"3"===t?a.props.x+i>=40&&a.props.x+i<=a.state.width/2-40&&a.props.y-o>=60&&a.props.y-o<=a.state.height/2-40&&a.props.setXY({x:a.props.x+i,y:a.props.y-o}):"4"===t&&a.props.x-i>=40&&a.props.x-i<=a.state.width/2-40&&a.props.y-o>=60&&a.props.y-o<=a.state.height/2-40&&a.props.setXY({x:a.props.x-i,y:a.props.y-o})},a.handleStart=function(t,e,n){var i=n.deltaX,o=n.deltaY;a.props.setDragging(!0),a.updateXY(t,e,{deltaX:i,deltaY:o})},a.handleStop=function(t,e,n){var i=n.deltaX,o=n.deltaY;a.props.setDragging(!1),a.updateXY(t,e,{deltaX:i,deltaY:o})},a.handleDrag=function(t,e,n){var i=n.deltaX,o=n.deltaY;a.updateXY(t,e,{deltaX:i,deltaY:o})},a.state={width:0,height:600,dragging:!1},a}return Object(u.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){this.updateWindowDimensions(),window.addEventListener("resize",this.updateWindowDimensions)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWindowDimensions)}},{key:"render",value:function(){var t=this.state.width,e=this.state.height;return i.a.createElement("div",{className:"selector"},i.a.createElement("div",{className:"shader",style:{position:"absolute",left:0,top:0,height:"".concat(e,"px"),width:"".concat(this.props.x,"px")}}),i.a.createElement("div",{className:"shader",style:{position:"absolute",left:"".concat(t-this.props.x,"px"),top:0,height:"".concat(e,"px"),width:"".concat(this.props.x,"px")}}),i.a.createElement("div",{className:"shader",style:{position:"absolute",left:"".concat(this.props.x,"px"),top:0,height:"".concat(this.props.y,"px"),width:"".concat(t-2*this.props.x,"px")}}),i.a.createElement("div",{className:"shader",style:{position:"absolute",left:"".concat(this.props.x,"px"),top:"".concat(e-this.props.y,"px"),height:"".concat(this.props.y,"px"),width:"".concat(t-2*this.props.x,"px")}}),i.a.createElement(k.DraggableCore,{onStart:this.handleStart.bind(this,"1"),onDrag:this.handleDrag.bind(this,"1"),onStop:this.handleStop.bind(this,"1")},i.a.createElement("div",{className:"handler",style:{top:this.props.y-6,left:this.props.x-6}})),i.a.createElement(k.DraggableCore,{onStart:this.handleStart.bind(this,"2"),onDrag:this.handleDrag.bind(this,"2"),onStop:this.handleStop.bind(this,"2")},i.a.createElement("div",{className:"handler",style:{top:this.props.y-6,left:t-this.props.x-6}})),i.a.createElement(k.DraggableCore,{onStart:this.handleStart.bind(this,"3"),onDrag:this.handleDrag.bind(this,"3"),onStop:this.handleStop.bind(this,"3")},i.a.createElement("div",{className:"handler",style:{top:e-this.props.y-6,left:this.props.x-6}})),i.a.createElement(k.DraggableCore,{onStart:this.handleStart.bind(this,"4"),onDrag:this.handleDrag.bind(this,"4"),onStop:this.handleStop.bind(this,"4")},i.a.createElement("div",{className:"handler",style:{top:e-this.props.y-6,left:t-this.props.x-6}})))}}]),e}(n.Component),O="pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA",x=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(h.a)(this,Object(d.a)(e).call(this,t))).resize=function(){a.setState({width:.9*window.innerWidth}),a.handleViewportChange({width:"100%"})},a.handleViewportChange=function(t){if(!1===a.state.isdragging&&(a.setState({viewport:Object(v.a)({},a.state.viewport,t)}),a.mapRef.current)){var e=a.mapRef.current.getMap().getBounds();a.setState({selBounds:{n:e._ne.lat,s:e._sw.lat,w:e._sw.lng,e:e._ne.lng}})}},a.handleOnResult=function(t){console.log(t.result)},a.handleGeocoderViewportChange=function(t){console.log(t),a.handleViewportChange(Object(v.a)({},t,{transitionDuration:100}))},a.setDragging=function(t){a.setState({isdragging:t})},a.setXY=function(t){a.setState({selector:t})},a.getDistance=function(t,e,a,n){var i=t*Math.PI/180,o=a*Math.PI/180,s=(a-t)*Math.PI/180,r=(n-e)*Math.PI/180,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(i)*Math.cos(o)*Math.sin(r/2)*Math.sin(r/2);return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},a.getBoundArea=function(t,e,n,i){return a.getDistance(t,n,t,i)*a.getDistance(t,n,e,n)},a.state={viewport:{width:"100%",height:"600px",latitude:48.1358,longitude:11.5611,zoom:15},selector:{x:0,y:0},isdragging:!1,selBounds:{n:0,s:0,w:0,e:0},width:0},a.mapRef=i.a.createRef(),a}return Object(u.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.resize),this.resize();var t=this.mapRef.current.getMap().getBounds();this.setState({selBounds:{n:t._ne.lat,s:t._sw.lat,w:t._sw.lng,e:t._ne.lng},selector:{x:.9*window.innerWidth/4,y:150}})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize)}},{key:"render",value:function(){var t=this.state,e=t.viewport,a=t.selector,n=t.selBounds,o=n.n-a.y/600*(n.n-n.s),s=n.s+a.y/600*(n.n-n.s),r=n.w+a.x/this.state.width*(n.e-n.w),l=n.e-a.x/this.state.width*(n.e-n.w),c=this.getBoundArea(o,s,r,l).toFixed(2);return i.a.createElement("div",null,i.a.createElement(b.default,Object.assign({className:"map",ref:this.mapRef},e,{onViewportChange:this.handleViewportChange,mapboxApiAccessToken:O,mapStyle:"mapbox://styles/mapbox/streets-v9"}),i.a.createElement(w.a,{mapRef:this.mapRef,onResult:this.handleOnResult,onViewportChange:this.handleGeocoderViewportChange,mapboxApiAccessToken:O,position:"top-left"}),i.a.createElement("div",{className:"control"},i.a.createElement(b.NavigationControl,{showCompass:!1,onViewportChange:this.handleViewportChange})),i.a.createElement(M,Object.assign({},a,{setDragging:this.setDragging,setXY:this.setXY}))),c<=4e6?i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"area-indicator"},i.a.createElement("div",{className:"area-indicator-fill",style:{width:c/4e6*200}})),i.a.createElement("div",{className:"area-number"},"Area: ",c," m \xb2"),i.a.createElement(m.a,{to:"".concat("/infomap","/selected/").concat(r,"/").concat(s,"/").concat(l,"/").concat(o)},i.a.createElement("div",{className:"button proceed-button"},"Proceed to Analysis ")),i.a.createElement("div",{className:"proceed-alert green"}," You can use this selected region. ")):i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"area-indicator"},i.a.createElement("div",{className:"area-indicator-fill area-exceed",style:{width:200}})),i.a.createElement("div",{className:"area-number"},"Area: >5 km \xb2"),i.a.createElement("div",{className:"button button-disabled proceed-button"},"Proceed to Analysis "),i.a.createElement("div",{className:"proceed-alert red"}," Area of the selected region is too big. ")),i.a.createElement("div",{className:"clearfix"}),i.a.createElement("div",{className:"raw"},i.a.createElement("div",null,i.a.createElement("p",null,"Viewport Coordinates:"),i.a.createElement("p",null," ","n: ".concat(n.n," s: ").concat(n.s," w: ").concat(n.w," e: ").concat(n.e))),i.a.createElement("div",null,i.a.createElement("p",null,"Selected Region Coordinates:"),i.a.createElement("p",null," ","n: ".concat(o," s: ").concat(s," w: ").concat(r," e: ").concat(l))),i.a.createElement("div",null,i.a.createElement("p",null,"Selected Region Area:"),i.a.createElement("p",null," ",c))),"}")}}]),e}(n.Component),j=Object(E.a)(x),N=function(t){function e(){return Object(c.a)(this,e),Object(h.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return i.a.createElement("div",{className:"content-wrapper"},i.a.createElement("div",{className:"title"},"Select an Area"),i.a.createElement(j,null))}}]),e}(i.a.Component),S=function(t){function e(){return Object(c.a)(this,e),Object(h.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",null,"Help"))}}]),e}(i.a.Component),C=function(t){function e(){return Object(c.a)(this,e),Object(h.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",null,"About"))}}]),e}(i.a.Component),D=a(142),_=a.n(D),T=(a(221),function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(h.a)(this,Object(d.a)(e).call(this,t))).getBuildingCat=function(t){var e=5;return[["apartments","farm","hotel","house","detached","residential","dormitory","terrace","houseboat","bungalow","static_caravan","cabin"],["commercial","office","industrial","retail","supermarket","warehouse","kiosk"],["religious","cathedral","chapel","church","mosque","temple","synagogue","shrine"],["bakehouse","kindergarten","civic","government","hospital","school","stadium","train_station","transportation","university","grandstand","public","toilets","service","parking","garages","garage","sports_hall","bridge","\tcarport","hangar"],["greenhouse","pavilion","farm_auxiliary","barn"]].forEach(function(a,n){-1!==a.indexOf(t)&&(e=n)}),e},a.showTooltip=function(t,e){var n=e.target.getBBox();n.x+n.width/2>=a.props.width/2?a.setState({left:!0}):a.setState({left:!1}),a.setState({tooltip:!0,info:t})},a.hideTooltip=function(){a.setState({tooltip:!1,info:{}})},a.state={tooltip:!1,info:{},left:!0},a}return Object(u.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var t=[],e=this.props,a=e.width,n=e.height,o=(e.nodes,e.ways),s=e.relations,r=this.state.info,l=[{fill:"#ad4a00"},{fill:"#7693d3"},{fill:"#0053cc"},{fill:"#cb00d1"},{fill:"#b6ff97"},{fill:"rgba(60, 60, 60)"},{fill:"rgba(52, 168, 0, .4)"}],c=-1,p=null,h="rgba(60, 60, 60)";for(var d in s)if(s[d].tag.building||s[d].tag["buidling:part"]){var u="";h="rgba(60,60,60)",s[d].members.forEach(function(t){if("way"===t.type&&t.value){var e=t.value.map(function(t){return t.join(",")}).join(" ");u+="M ".concat(e)}}),"Height"===this.props.option?(p=s[d].tag["building:levels"])?(h="rgba(0,0,255,".concat(p/10,")"),t.push(i.a.createElement("path",{d:u,fillRule:"evenodd",fill:h,stroke:"white",strokeWidth:".5",key:d,className:"nolli-building",onMouseEnter:this.showTooltip.bind(this,s[d].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,d)))):t.unshift(i.a.createElement("path",{d:u,fillRule:"evenodd",fill:h,stroke:"white",strokeWidth:".5",key:d,className:"nolli-building",onMouseEnter:this.showTooltip.bind(this,s[d].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,d))):"Program"===this.props.option?(c=this.getBuildingCat(s[d].tag.building),t.push(i.a.createElement("path",{d:u,fillRule:"evenodd",fill:l[c].fill,stroke:"white",strokeWidth:".5",key:d,className:"nolli-building",onMouseEnter:this.showTooltip.bind(this,s[d].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,d)))):"None"===this.props.option&&t.push(i.a.createElement("path",{d:u,fillRule:"evenodd",fill:h,stroke:"white",strokeWidth:".5",key:d,className:"nolli-building",onMouseEnter:this.showTooltip.bind(this,s[d].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,d)))}else if((s[d].tag.leisure||"grass"===s[d].tag.landuse)&&"Program"===this.props.option){u="";s[d].members.forEach(function(t){if("way"===t.type&&t.value){var e=t.value.map(function(t){return t.join(",")}).join(" ");u+="M ".concat(e)}}),t.push(i.a.createElement("path",{d:u,fillRule:"evenodd",fill:l[6].fill,stroke:"white",strokeWidth:".5",key:d,className:"nolli-building",onMouseEnter:this.showTooltip.bind(this,s[d].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,d)))}for(d in o)if(o[d].tag.building){var m=o[d].points.map(function(t){return t.join(",")}).join(" ");h="rgba(60,60,60)","Height"===this.props.option?(p=o[d].tag["building:levels"])?(h="rgba(0,0,255,".concat(p/10,")"),t.push(i.a.createElement("polygon",{points:m,fill:h,stroke:"white",strokeWidth:".5",key:d,className:"nolli-building",onMouseEnter:this.showTooltip.bind(this,o[d].tag),onMouseLeave:this.hideTooltip.bind(this)}))):t.unshift(i.a.createElement("polygon",{points:m,fill:h,stroke:"white",strokeWidth:".5",key:d,className:"nolli-building",onMouseEnter:this.showTooltip.bind(this,o[d].tag),onMouseLeave:this.hideTooltip.bind(this)})):"Program"===this.props.option?(c=this.getBuildingCat(o[d].tag.building),t.push(i.a.createElement("polygon",{points:m,fill:l[c].fill,stroke:"white",strokeWidth:".5",key:d,className:"nolli-building",onMouseEnter:this.showTooltip.bind(this,o[d].tag),onMouseLeave:this.hideTooltip.bind(this)}))):"None"===this.props.option&&t.push(i.a.createElement("polygon",{points:m,fill:h,stroke:"white",strokeWidth:".5",key:d,className:"nolli-building",onMouseEnter:this.showTooltip.bind(this,o[d].tag),onMouseLeave:this.hideTooltip.bind(this)}))}else if((o[d].tag.leisure||"grass"===o[d].tag.landuse)&&"Program"===this.props.option){m=o[d].points.map(function(t){return t.join(",")}).join(" ");t.push(i.a.createElement("polygon",{points:m,fill:l[6].fill,stroke:"white",strokeWidth:".5",key:d,className:"nolli-building",onMouseEnter:this.showTooltip.bind(this,o[d].tag),onMouseLeave:this.hideTooltip.bind(this)}))}var g=[];for(var f in r)if("building"!==f||"yes"!==r[f]){var v=f.charAt(0).toUpperCase()+f.substr(1).toLowerCase();g.push(i.a.createElement("div",{className:"tooltip-info",key:f},i.a.createElement("span",{className:"tooltip-key"},v,": "),r[f]," ","Footprint"===v?decodeURI("m%C2%B2"):""))}var b={};return b=this.state.left?{top:"0",left:"0"}:{top:"0",right:"0"},i.a.createElement("div",{className:"nollimap"},i.a.createElement("svg",{version:"1.1",viewBox:"0 0 ".concat(a," ").concat(n),style:{width:this.state.width}},t),i.a.createElement("div",{className:this.state.tooltip?"tooltip":"hide",style:b},i.a.createElement("div",{className:"tooltip-title"},"Building Details"),g))}}]),e}(i.a.Component)),W=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(h.a)(this,Object(d.a)(e).call(this,t))).showTooltip=function(t,e){var n=e.target.getBBox();n.x+n.width/2>=a.props.width/2?a.setState({left:!0}):a.setState({left:!1}),a.setState({tooltip:!0,info:t})},a.hideTooltip=function(){a.setState({tooltip:!1,info:{}})},a.getWayCat=function(t){var e=5;return[["motorway","trunk","motorway_link","trunk_link"],["primary","primary_link"],["secondary","tertiary","secondary_link","tertiary_link","raceway"],["unclassified","residential","living_street","road","escape"],["service","pedestrian","track","bus_guideway","footway","bridleway","steps","path","cycleway"]].forEach(function(a,n){-1!==a.indexOf(t)&&(e=n)}),e},a.state={tooltip:!1,info:{},left:!0},a}return Object(u.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){var t=this,e=[[],[],[],[],[],[]],a=this.props,n=a.width,o=a.height,s=(a.nodes,a.ways),r=a.relations,l=this.state.info,c=[{color:"#b5451a",strokeWidth:"8"},{color:"#f15c22",strokeWidth:"6"},{color:"#f47d4e",strokeWidth:"6"},{color:"#f79d7a",strokeWidth:"4"},{color:"#f9bea7",strokeWidth:"3"},{color:"#fcded3",strokeWidth:"4"}],p=-1,h={};for(var d in s)if(s[d].tag.highway&&("Roads"===this.props.option||"Both"===this.props.option)){var u=s[d].points.map(function(t){return t.join(",")}).join(" ");h=c[p=this.getWayCat(s[d].tag.highway)],e[5-p].push(i.a.createElement("path",{d:"M ".concat(u),fill:"none",stroke:h.color,strokeWidth:h.strokeWidth,strokeLinecap:"round",strokeLinejoin:"round",key:d+"w",onMouseEnter:this.showTooltip.bind(this,s[d].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,d)))}for(d in r)if(!r[d].tag.route||"Public Transport"!==this.props.option&&"Both"!==this.props.option){if(r[d].tag.highway&&("Roads"===this.props.option||"Both"===this.props.option)){var m="";r[d].members.forEach(function(t){if("way"===t.type&&t.value){var e=t.value.map(function(t){return t.join(",")}).join(" ");m+="M ".concat(e)}}),h=c[p=this.getWayCat(r[d].tag.highway)],e[5-p].push(i.a.createElement("path",{d:m,fillRule:"evenodd",fill:h.color,stroke:"none",key:d,className:"nolli-building",onMouseEnter:this.showTooltip.bind(this,r[d].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,d)))}}else r[d].members.forEach(function(a,n){if("way"===a.type&&a.value){var o=a.value.map(function(t){return t.join(",")}).join(" ");e.push(i.a.createElement("path",{d:"M ".concat(o),fill:"none",stroke:"red",strokeWidth:"1",key:n.toString()+d,onMouseEnter:t.showTooltip.bind(t,r[d].tag),onMouseLeave:t.hideTooltip.bind(t)},i.a.createElement("title",null,d)))}else if("node"===a.type&&a.value){var s=20;"subway"!==r[d].tag.route&&"train"!==r[d].tag.route||(s=40),e.push(i.a.createElement("g",{key:n.toString()+d},i.a.createElement("circle",{cx:a.value[0],cy:a.value[1],r:s,fill:"rgba(255,90,90,.2)",onMouseEnter:t.showTooltip.bind(t,r[d].tag),onMouseLeave:t.hideTooltip.bind(t)},i.a.createElement("title",null,d)),i.a.createElement("circle",{cx:a.value[0],cy:a.value[1],r:"2",fill:"#803535",onMouseEnter:t.showTooltip.bind(t,r[d].tag),onMouseLeave:t.hideTooltip.bind(t)},i.a.createElement("title",null,d))))}});var g=[];for(var f in l){var v=f.charAt(0).toUpperCase()+f.substr(1).toLowerCase();g.push(i.a.createElement("div",{className:"tooltip-info",key:f},i.a.createElement("span",{className:"tooltip-key"},v,": "),l[f]," ","Footprint"===v?decodeURI("m%C2%B2"):""))}var b={};return b=this.state.left?{top:"0",left:"0"}:{top:"0",right:"0"},i.a.createElement("div",{className:"nollimap"},i.a.createElement("svg",{version:"1.1",viewBox:"0 0 ".concat(n," ").concat(o),style:{width:this.state.width}},e),i.a.createElement("div",{className:this.state.tooltip?"tooltip":"hide",style:b},i.a.createElement("div",{className:"tooltip-title"},"Route Details"),g))}}]),e}(i.a.Component);function A(t){return t*Math.PI/180}function L(t,e,a,n){return(a-t)*(a-t)+(n-e)*(n-e)}var R=a(224),P=R.intersect,B=R.shape,Y=function(t){function e(t){var a;Object(c.a)(this,e),(a=Object(h.a)(this,Object(d.a)(e).call(this,t))).handleStart=function(t,e,n){var i=n.deltaX,o=n.deltaY;a.props.setPos(t,[a.props.humans[t][0]+i,a.props.humans[t][1]+o]),a.props.setRegion(t,"M".concat(a.props.humans[t][0]/a.props.ratio,",").concat(a.props.humans[t][1]/a.props.ratio," ")),a.props.setArc(t,0)},a.handleStop=function(t,e,n){var i=n.deltaX,o=n.deltaY;a.props.setPos(t,[a.props.humans[t][0]+i,a.props.humans[t][1]+o]),a.props.setRegion(t,"M".concat(a.props.humans[t][0]/a.props.ratio,",").concat(a.props.humans[t][1]/a.props.ratio," ")),a.props.setArc(t,0)},a.handleDrag=function(t,e,n){var i=n.deltaX,o=n.deltaY;a.props.setPos(t,[a.props.humans[t][0]+i,a.props.humans[t][1]+o]),a.props.setRegion(t,"M".concat(a.props.humans[t][0]/a.props.ratio,",").concat(a.props.humans[t][1]/a.props.ratio," ")),a.props.setArc(t,0)},a.showTooltip=function(t,e,n){var i=n.target.getBBox();if(i.x+i.width/2>=a.props.width/2?a.setState({left:!0}):a.setState({left:!1}),a.props.arcs[e]>=360){var o=t.substring(1,t.length-2).split(" "),s=[],r=[];o.forEach(function(t){r=t.split(","),s.push([parseFloat(r[0]),parseFloat(r[1])])});var l=function(t){var e=t,a=0;if(e.length<3)return 0;for(var n=0;n<e.length-1;n+=1)a+=e[n][0]*e[n+1][1]-e[n+1][0]*e[n][1];return Math.abs(1*a/2)}(s)/a.props.lengthratio/a.props.lengthratio;a.setState({tooltip:!0,info:"Visible Area: ".concat(l.toFixed(2)),shaded:t})}else a.setState({tooltip:!0,info:"Calculating area..."})},a.hideTooltip=function(){a.setState({tooltip:!1,info:"",shaded:""})},a.updateRegions=function(){var t=a.props.regions,e=a.props.arcs,n=!1;for(var i in e)if(e[i]<360){n=!0;var o=e[i],s=t[i];if(""===s&&(s="M".concat(a.props.humans[i][0]/a.props.ratio,",").concat(a.props.humans[i][1]/a.props.ratio," ")),o+a.angle>=360){var r=s.split(" ");r.shift(),s="M"+r.join(" ")+"Z"}else{var l=a.props.width,c=a.props.height,p=Math.max(l,c),h=a.props.humans[i][0]/a.ratio,d=a.props.humans[i][1]/a.ratio,u=P(B("line",{x1:h+p*Math.sin(A(o)),y1:d+p*Math.cos(A(o)),x2:h,y2:d}),B("path",{d:a.buildings})),m=l*l+c*c,g=P(B("line",{x1:h+p*Math.sin(A(o)),y1:d+p*Math.cos(A(o)),x2:h,y2:d}),B("rect",{x:0,y:0,width:a.props.width,height:a.props.height})).points[0];u.points.forEach(function(t){L(h,d,t.x,t.y)<m&&(m=L(h,d,t.x,t.y),g=t)}),s+="".concat(g.x,",").concat(g.y," ")}t[i]=s,e[i]=o+a.angle}n&&(a.props.setRegions(t),a.props.setArcs(e))},a.ratio=a.props.ratio,a.angle=2;var n="",i=a.props,o=(i.nodes,i.ways),s=i.relations;for(var r in s)if(s[r].tag.building||s[r].tag["buidling:part"]){var l="";s[r].members.forEach(function(t){if("way"===t.type&&t.value){var e=t.value.map(function(t){return t.join(",")}).join(" ");l+="M ".concat(e)}}),n+=l}for(r in o)if(o[r].tag.building){var p=o[r].points.map(function(t){return t.join(",")}).join(" ");n+="M ".concat(p)}for(var u in a.buildings=n,a.props.regions)""===a.props.regions[u]&&a.props.setRegion(u,"M".concat(a.props.humans[u][0]/a.props.ratio,",").concat(a.props.humans[u][1]/a.props.ratio," "));return a.state={tooltip:0,shaded:"",info:"",left:!0},a}return Object(u.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){var t=this;this.interval=setInterval(function(){return t.updateRegions()},50)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){var t=this,e=["rgba(255, 139, 0, .4)","rgba(0, 139, 255, .2)","rgba(139, 255, 0, .2)","rgba(255, 0, 139, .2)","rgba(0, 255, 139, .2"],a=this.props.regions.map(function(a,n){return i.a.createElement("path",{d:a,fill:e[0],stroke:"red",strokeWidth:"1",key:n,onMouseEnter:t.showTooltip.bind(t,a,n),onMouseLeave:t.hideTooltip.bind(t)})}),n=this.props.humans.map(function(e,a){return i.a.createElement("circle",{cx:e[0]/t.ratio,cy:e[1]/t.ratio,r:"3",fill:"red",key:a})}),o=this.props.humans.map(function(e,a){return i.a.createElement(k.DraggableCore,{onStart:t.handleStart.bind(t,a),onDrag:t.handleDrag.bind(t,a),onStop:t.handleStop.bind(t,a),key:a},i.a.createElement("div",{className:"human",style:{top:e[1]-15,left:e[0]-15}}))}),s={};return s=this.state.left?{top:"0",left:"0"}:{top:"0",right:"0"},i.a.createElement("div",{className:"visibilitymap"},i.a.createElement("svg",{version:"1.1",viewBox:"0 0 ".concat(this.props.width," ").concat(this.props.height),ref:function(e){return t.container=e}},i.a.createElement("path",{d:this.state.shaded,fill:"#f15c22",stroke:"none"}),i.a.createElement("path",{d:this.buildings,fill:"rgba(0, 0, 0, .1)",stroke:"rgba(60, 60, 60)",strokeWidth:".5"}),a,n),o,i.a.createElement("div",{className:this.state.tooltip?"tooltip":"hide",style:s},i.a.createElement("div",{className:"tooltip-title"},this.state.info)))}}]),e}(i.a.Component),X=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(h.a)(this,Object(d.a)(e).call(this,t))).getDistance=function(t,e,a,n){var i=t*Math.PI/180,o=a*Math.PI/180,s=(a-t)*Math.PI/180,r=(n-e)*Math.PI/180,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(i)*Math.cos(o)*Math.sin(r/2)*Math.sin(r/2);return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},n.getDirDistance=function(t,e,a,i){return a<=t&&i>=e?n.getDistance(t,e,a,i):-n.getDistance(t,e,a,i)},n.getBoundArea=function(t,e,a,i){return n.getDistance(t,a,t,i)*n.getDistance(t,a,e,a)},n.checkSingle=function(t){return Array.isArray(t)?t:t?[t]:[]},n.getWayPoints=function(t){var e="";return t.forEach(function(t){e+="".concat(t.x,",").concat(t.y," ")}),e},n.mapPix=function(t,e,a,n,i){return n+(t-e)*(i-n)/(a-e)},n.addLoading=function(t){n.setState({loading:n.state.loading+t})},n.resetLoading=function(){n.setState({loading:0})},n.updateStates=function(){var t=n.props,e=t.nlat,i=t.slat,o=t.wlng,s=t.elng,r=t.rawdata,l=n.state.width,c=l/n.getDistance(e,o,e,s),p=n.getDistance(e,o,i,o)*c,h={},d={},u={};if(r){var m=a(231).xml2js(r,{compact:!0,spaces:4}),g=n.checkSingle(m.osm.node),f=n.checkSingle(m.osm.way),v=n.checkSingle(m.osm.relation);g.forEach(function(t){var a=t._attributes.id,r=n.checkSingle(t.tag);h[a]={element:t},h[a].x=n.mapPix(t._attributes.lon,o,s,0,l),h[a].y=n.mapPix(t._attributes.lat,e,i,0,p),h[a].tag={},r.forEach(function(t){h[a].tag[t._attributes.k]=t._attributes.v})}),f.forEach(function(t){var e=t._attributes.id,a=n.checkSingle(t.nd),i=n.checkSingle(t.tag);if(d[e]={element:t},d[e].children=[],d[e].points=[],d[e].tag={},a.forEach(function(t){d[e].children.push(h[t._attributes.ref]),d[e].points.push([h[t._attributes.ref].x,h[t._attributes.ref].y])}),i.forEach(function(t){d[e].tag[t._attributes.k]=t._attributes.v}),d[e].tag.building){var o=n.getArea(d[e].points)/c/c;d[e].footprint=o,d[e].tag.footprint=o.toFixed(2)}}),v.forEach(function(t){var e=t._attributes.id,a=n.checkSingle(t.member),i=n.checkSingle(t.tag);if(u[e]={element:t},u[e].children=[],u[e].members=[],u[e].tag={},a.forEach(function(t){u[e].children.push(d[t._attributes.ref]),"way"===t._attributes.type&&d[t._attributes.ref]?u[e].members.push({type:"way",value:d[t._attributes.ref].points,role:t._attributes.role}):"node"===t._attributes.type&&h[t._attributes.ref]?u[e].members.push({type:"node",value:[h[t._attributes.ref].x,h[t._attributes.ref].y],role:t._attributes.role}):"relation"===t._attributes.type&&u[t._attributes.ref]&&u[e].members.push({type:"relation",value:u[t._attributes.ref].members,role:t._attributes.role})}),i.forEach(function(t){u[e].tag[t._attributes.k]=t._attributes.v}),u[e].tag.building||u[e].tag["buidling:part"]){var o=0;u[e].members.forEach(function(t){"outer"===t.role?o+=n.getArea(t.value):"outer"===t.role&&(o-=n.getArea(t.value))}),o=o/c/c,u[e].footprint=o,u[e].tag.footprint=o.toFixed(2)}}),n.addLoading(100)}n.pixratio=n.container.offsetWidth/1e3,n.ratio=c,n.setState({height:p,nodes:h,ways:d,relations:u,humans:[[Math.random()*l,Math.random()*p]]}),console.log(h),console.log(d),console.log(u),console.log(c)},n.getOptions=function(){var t=a(249)[n.props.selected],e=n.state.options[n.props.selected],o=[];return t&&(o.push(i.a.createElement("div",{className:"options-title",key:"title"},t.title)),t.options.forEach(function(t){o.push(i.a.createElement("div",{className:t===e?"options-item selected":"options-item",onClick:function(){n.setOption(t)},key:t},t))})),"Visibility"===n.props.selected&&(o.push(i.a.createElement("div",{className:"options-title",key:"title"},"You can add up to 5 viewing points:")),o.push(i.a.createElement("button",{className:"options-button",onClick:n.addHuman,key:"add",disabled:n.state.arcs.length>=5},"Add a Point")),o.push(i.a.createElement("button",{className:"options-button",onClick:n.deleteHuman,key:"delete",disabled:n.state.arcs.length<=1},"Delete a Point"))),o},n.setOption=function(t){var e=n.state.options;e[n.props.selected]=t,n.setState({options:e}),console.log("reset!")},n.setPos=function(t,e){var a=n.state.humans;a[t]=e,n.setState({humans:a})},n.setArc=function(t,e){var a=n.state.arcs;a[t]=e,n.setState({arc:a})},n.setRegion=function(t,e){var a=n.state.regions;a[t]=e,n.setState({regions:a})},n.setArcs=function(t){n.setState({arc:t})},n.setRegions=function(t){n.setState({regions:t})},n.addHuman=function(){var t=n.state.humans,e=n.state.arcs,a=n.state.regions;t.push([Math.random()*n.state.width,Math.random()*n.state.height]),e.push(0),a.push(""),n.setState({humans:t,arcs:e,regions:a})},n.deleteHuman=function(){var t=n.state.humans,e=n.state.arcs,a=n.state.regions;t.pop(),e.pop(),a.pop(),n.setState({humans:t,arcs:e,regions:a})},n.state={loading:0,width:1e3,height:0,nodes:{},ways:{},relations:{},humans:[[500,250]],arcs:[0],regions:[""],options:{"Nolli Map":"None",Traffic:"Both",Visibility:"Both"}},n}return Object(u.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){this.updateStates()}},{key:"componentDidUpdate",value:function(t){this.props.rawdata!==t.rawdata&&(this.resetLoading(),this.updateStates())}},{key:"getArea",value:function(t){var e=t,a=0;if(e.length<3)return 0;for(var n=0;n<e.length-1;n+=1)a+=e[n][0]*e[n+1][1]-e[n+1][0]*e[n][1];return Math.abs(1*a/2)}},{key:"render",value:function(){var t=this,e=this.getOptions(),a=this.state,n=a.ways,o=a.nodes,s=a.relations,r=a.width,l=a.height,c={},p=[];for(var h in c["Nolli Map"]=i.a.createElement(T,{nodes:o,ways:n,relations:s,width:r,height:l,getWayPoints:this.getWayPoints,addLoading:this.addLoading,nlat:this.props.nlat,slat:this.props.slat,wlng:this.props.wlng,elng:this.props.elng,option:this.state.options["Nolli Map"],key:"Nolli Map"}),c.Traffic=i.a.createElement(W,{nodes:o,ways:n,relations:s,width:r,height:l,getWayPoints:this.getWayPoints,addLoading:this.addLoading,nlat:this.props.nlat,slat:this.props.slat,wlng:this.props.wlng,elng:this.props.elng,key:"Traffic",option:this.state.options.Traffic}),c.Visibility=i.a.createElement(Y,{nodes:o,ways:n,relations:s,width:r,height:l,humans:this.state.humans,arcs:this.state.arcs,regions:this.state.regions,setPos:this.setPos,setArc:this.setArc,setRegion:this.setRegion,setArcs:this.setArcs,setRegions:this.setRegions,addLoading:this.addLoading,nlat:this.props.nlat,slat:this.props.slat,wlng:this.props.wlng,elng:this.props.elng,key:"Visibility",option:this.state.options.Traffic,ratio:this.pixratio,lengthratio:this.ratio}),this.props.added)this.props.added[h]&&p.unshift(c[h]);return i.a.createElement("div",{className:"maps-wrapper",ref:function(e){return t.container=e}},i.a.createElement("div",{className:"options"},e),i.a.createElement("svg",{version:"1.1",viewBox:"0 0 ".concat(this.state.width," ").concat(this.state.height),style:{width:this.state.width}}),i.a.createElement("div",{className:100===this.state.loading?"hide":"loading"},"Loading... "),"Overlay"===this.props.selected?p:c[this.props.selected])}}]),e}(i.a.Component),I=(a(250),a(292),function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(h.a)(this,Object(d.a)(e).call(this,t))).changeMap=function(t){a.props.changeMap(t)},a.addOverlay=function(t,e){t.stopPropagation(),a.props.addOverlay(e)},a.removeOverlay=function(t,e){t.stopPropagation(),a.props.removeOverlay(e)},a.handleUpdate=function(t,e){console.log(t),console.log(e)},a.renderMenu=function(){var t=a.props,e=t.layers,n=t.added,o=t.selected,s=[];return e.forEach(function(t,e){s.push(i.a.createElement("div",{className:t===o?"menu-item selected":"menu-item",key:"".concat(t),onClick:function(){return a.changeMap(t)}},i.a.createElement("div",{className:"menu-subtitle"},t),n[t]?i.a.createElement("svg",{version:"1.1",viewBox:"0 0 80 80",className:t===o?"icon selected":"icon",onClick:function(e){return a.removeOverlay(e,t)}},i.a.createElement("path",{id:"XMLID_6_",d:"M74,45H6c-2.8,0-5-2.2-5-5s2.2-5,5-5h68c2.8,0,5,2.2,5,5S76.8,45,74,45z"})):i.a.createElement("svg",{version:"1.1",viewBox:"0 0 80 80",className:t===o?"icon selected":"icon",onClick:function(e){return a.addOverlay(e,t)}},i.a.createElement("path",{d:"M74,35H45V6c0-2.8-2.2-5-5-5s-5,2.2-5,5v29H6c-2.8,0-5,2.2-5,5c0,2.8,2.2,5,5,5h29v29c0,2.8,2.2,5,5,5s5-2.2,5-5V45h29 c2.8,0,5-2.2,5-5C79,37.2,76.8,35,74,35z"})),i.a.createElement("div",{className:"clearfix"})))}),s},a.state={menu:a.props.layers,added:a.props.added,selected:a.props.selected},a}return Object(u.a)(e,t),Object(p.a)(e,[{key:"render",value:function(){var t=this,e=this.renderMenu();return i.a.createElement("div",{className:"menu"},i.a.createElement(m.a,{to:"".concat("/infomap","/"),className:"back"},i.a.createElement("svg",{version:"1.1",viewBox:"0 0 80 80",className:"back-icon"},i.a.createElement("path",{id:"XMLID_7_",d:"M74,35H18.1l23.5-23.5c2-2,2-5.1,0-7.1c-2-2-5.1-2-7.1,0l-32,32c0,0,0,0,0,0C2.2,36.7,2,37,1.8,37.2 c-0.1,0.1-0.1,0.3-0.2,0.4c-0.1,0.2-0.2,0.3-0.2,0.5c-0.1,0.2-0.1,0.3-0.2,0.5c0,0.1-0.1,0.3-0.1,0.4c-0.1,0.6-0.1,1.3,0,2 c0,0.1,0.1,0.3,0.1,0.4c0.1,0.2,0.1,0.3,0.2,0.5c0.1,0.2,0.2,0.3,0.2,0.5c0.1,0.1,0.1,0.3,0.2,0.4C2,43,2.2,43.3,2.5,43.5l32,32 c1,1,2.3,1.5,3.5,1.5s2.6-0.5,3.5-1.5c2-2,2-5.1,0-7.1L18.1,45H74c2.8,0,5-2.2,5-5S76.8,35,74,35z"})),i.a.createElement("div",{className:"title"},"Change Location")),i.a.createElement("div",{className:"clearfix"}),e,i.a.createElement("div",{className:"Overlay"===this.props.selected?"menu-item selected":"menu-item",onClick:function(){return t.changeMap("Overlay")}},i.a.createElement("div",{className:"menu-title"},"Overlay")))}}]),e}(i.a.Component)),V=Object(E.a)(I),H=(a(131),function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(h.a)(this,Object(d.a)(e).call(this,t))).changeMap=function(t){a.setState({selected:t})},a.addOverlay=function(t){var e=a.state.added;e[t]=!0,a.setState({added:e})},a.removeOverlay=function(t){var e=a.state.added;e[t]=!1,a.setState({added:e})},a.state={raw:null,layers:["Nolli Map","Visibility","Traffic"],added:{"Nolli Map":!0,Visibility:!1,Traffic:!0},selected:"Nolli Map"},a.bounds=a.props.match.params,a}return Object(u.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){var t=this;_.a.get("https://api.openstreetmap.org/api/0.6/map?bbox=".concat(this.bounds.wlng,",").concat(this.bounds.slat,",").concat(this.bounds.elng,",").concat(this.bounds.nlat)).then(function(e){e.data&&t.setState({raw:e.data})})}},{key:"render",value:function(){return i.a.createElement("div",{className:"maps"},i.a.createElement(V,{layers:this.state.layers,added:this.state.added,selected:this.state.selected,changeMap:this.changeMap,addOverlay:this.addOverlay,removeOverlay:this.removeOverlay}),i.a.createElement("div",{className:"map-display"},i.a.createElement(X,Object.assign({layers:this.state.layers,added:this.state.added,selected:this.state.selected},this.props.match.params,{rawdata:this.state.raw}))),i.a.createElement("div",{className:"clearfix"}),i.a.createElement("div",{className:"raw"},i.a.createElement("div",null,"n: ".concat(this.bounds.nlat," s: ").concat(this.bounds.slat," w: ").concat(this.bounds.wlng," e: ").concat(this.bounds.elng)),i.a.createElement("div",null,"API address: ","https://api.openstreetmap.org/api/0.6/map?bbox=".concat(this.bounds.wlng,",").concat(this.bounds.slat,",").concat(this.bounds.elng,",").concat(this.bounds.nlat))))}}]),e}(i.a.Component)),z=a(143),F=(i.a.Component,function(t){function e(){return Object(c.a)(this,e),Object(h.a)(this,Object(d.a)(e).apply(this,arguments))}return Object(u.a)(e,t),Object(p.a)(e,[{key:"componentDidUpdate",value:function(t){this.props.location!==t.location&&window.scrollTo(0,0)}},{key:"render",value:function(){return this.props.children}}]),e}(i.a.Component)),U=Object(E.a)(F),q=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(h.a)(this,Object(d.a)(e).call(this,t))).state={},a}return Object(u.a)(e,t),Object(p.a)(e,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return i.a.createElement("div",{className:"footer"},i.a.createElement("div",null,"Infomap v0.1.0 prototype \xa9 2018 Wu Chenmu"))}}]),e}(i.a.Component);a(297);s.a.render(i.a.createElement(r.a,null,i.a.createElement(U,null,i.a.createElement("div",{className:"content"},i.a.createElement(f,null),i.a.createElement(l.a,{exact:!0,path:"/infomap/",component:N}),i.a.createElement(l.a,{exact:!0,path:"/infomap/help",component:S}),i.a.createElement(l.a,{exact:!0,path:"/infomap/about",component:C}),i.a.createElement(l.a,{exact:!0,path:"/infomap/selected/:wlng/:slat/:elng/:nlat",component:H}),i.a.createElement(q,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[144,2,1]]]);
//# sourceMappingURL=main.f993c31b.chunk.js.map