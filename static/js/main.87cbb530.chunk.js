(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{126:function(e,t,a){},139:function(e,t,a){e.exports=a(288)},144:function(e,t,a){},152:function(e,t,a){},216:function(e,t,a){},224:function(e,t){},226:function(e,t){},237:function(e){e.exports={"Nolli Map":{title:"Coloring Mode:",options:["None","Height","Program"]},Traffic:{title:"Display:",options:["Both","Roads","Public Transport"]},Overlay:{title:"Options:",options:[]}}},280:function(e,t,a){},285:function(e,t,a){},288:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),o=a(52),s=a.n(o),r=a(294),l=a(150);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=a(5),p=a(4),d=a(7),h=a(6),u=a(8),m=a(147),g=a(290),f=(a(144),function(e){function t(){return Object(c.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"navbar-wrapper"},i.a.createElement("div",{className:"navbar-logo"},i.a.createElement(m.a,{to:"/infomap/"},i.a.createElement("img",{style:{height:40},src:"/infomap/image/logo.svg",alt:"Infomap Logo"}))),i.a.createElement("div",{className:"navbar-tabs"},i.a.createElement(g.a,{className:"navbar-tabitem",activeClassName:"navbar-tabitem-active",to:"/infomap/demo"},"Demo"),i.a.createElement(g.a,{className:"navbar-tabitem",activeClassName:"navbar-tabitem-active",to:"/infomap/about"},"About"),i.a.createElement(g.a,{className:"navbar-tabitem",activeClassName:"navbar-tabitem-active",to:"/infomap/help"},"Help")))}}]),t}(i.a.Component)),v=(a(152),a(88)),b=a(61),y=a(135),w=a.n(y),E=a(293),O=a(40),k=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).updateWindowDimensions=function(){a.setState({width:.9*window.innerWidth})},a.updateXY=function(e,t,n){var i=n.deltaX,o=n.deltaY;"1"===e?a.props.x+i>=40&&a.props.x+i<=a.state.width/2-40&&a.props.y+o>=60&&a.props.y+o<=a.state.height/2-40&&a.props.setXY({x:a.props.x+i,y:a.props.y+o}):"2"===e?a.props.x-i>=40&&a.props.x-i<=a.state.width/2-40&&a.props.y+o>=60&&a.props.y+o<=a.state.height/2-40&&a.props.setXY({x:a.props.x-i,y:a.props.y+o}):"3"===e?a.props.x+i>=40&&a.props.x+i<=a.state.width/2-40&&a.props.y-o>=60&&a.props.y-o<=a.state.height/2-40&&a.props.setXY({x:a.props.x+i,y:a.props.y-o}):"4"===e&&a.props.x-i>=40&&a.props.x-i<=a.state.width/2-40&&a.props.y-o>=60&&a.props.y-o<=a.state.height/2-40&&a.props.setXY({x:a.props.x-i,y:a.props.y-o})},a.handleStart=function(e,t,n){var i=n.deltaX,o=n.deltaY;a.props.setDragging(!0),a.updateXY(e,t,{deltaX:i,deltaY:o})},a.handleStop=function(e,t,n){var i=n.deltaX,o=n.deltaY;a.props.setDragging(!1),a.updateXY(e,t,{deltaX:i,deltaY:o})},a.handleDrag=function(e,t,n){var i=n.deltaX,o=n.deltaY;a.updateXY(e,t,{deltaX:i,deltaY:o})},a.state={width:0,height:600,dragging:!1},a}return Object(u.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.updateWindowDimensions(),window.addEventListener("resize",this.updateWindowDimensions)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWindowDimensions)}},{key:"render",value:function(){var e=this.state.width,t=this.state.height;return i.a.createElement("div",{className:"selector"},i.a.createElement("div",{className:"shader",style:{position:"absolute",left:0,top:0,height:"".concat(t,"px"),width:"".concat(this.props.x,"px")}}),i.a.createElement("div",{className:"shader",style:{position:"absolute",left:"".concat(e-this.props.x,"px"),top:0,height:"".concat(t,"px"),width:"".concat(this.props.x,"px")}}),i.a.createElement("div",{className:"shader",style:{position:"absolute",left:"".concat(this.props.x,"px"),top:0,height:"".concat(this.props.y,"px"),width:"".concat(e-2*this.props.x,"px")}}),i.a.createElement("div",{className:"shader",style:{position:"absolute",left:"".concat(this.props.x,"px"),top:"".concat(t-this.props.y,"px"),height:"".concat(this.props.y,"px"),width:"".concat(e-2*this.props.x,"px")}}),i.a.createElement(O.DraggableCore,{onStart:this.handleStart.bind(this,"1"),onDrag:this.handleDrag.bind(this,"1"),onStop:this.handleStop.bind(this,"1")},i.a.createElement("div",{className:"handler",style:{top:this.props.y-6,left:this.props.x-6}})),i.a.createElement(O.DraggableCore,{onStart:this.handleStart.bind(this,"2"),onDrag:this.handleDrag.bind(this,"2"),onStop:this.handleStop.bind(this,"2")},i.a.createElement("div",{className:"handler",style:{top:this.props.y-6,left:e-this.props.x-6}})),i.a.createElement(O.DraggableCore,{onStart:this.handleStart.bind(this,"3"),onDrag:this.handleDrag.bind(this,"3"),onStop:this.handleStop.bind(this,"3")},i.a.createElement("div",{className:"handler",style:{top:t-this.props.y-6,left:this.props.x-6}})),i.a.createElement(O.DraggableCore,{onStart:this.handleStart.bind(this,"4"),onDrag:this.handleDrag.bind(this,"4"),onStop:this.handleStop.bind(this,"4")},i.a.createElement("div",{className:"handler",style:{top:t-this.props.y-6,left:e-this.props.x-6}})))}}]),t}(n.Component),N="pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4M29iazA2Z2gycXA4N2pmbDZmangifQ.-g_vE53SD2WrJ6tFX7QHmA",M=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).resize=function(){a.setState({width:.9*window.innerWidth}),a.handleViewportChange({width:"100%"})},a.handleViewportChange=function(e){if(!1===a.state.isdragging&&(a.setState({viewport:Object(v.a)({},a.state.viewport,e)}),a.mapRef.current)){var t=a.mapRef.current.getMap().getBounds();a.setState({selBounds:{n:t._ne.lat,s:t._sw.lat,w:t._sw.lng,e:t._ne.lng}})}},a.handleOnResult=function(e){console.log(e.result)},a.handleGeocoderViewportChange=function(e){console.log(e),a.handleViewportChange(Object(v.a)({},e,{transitionDuration:100}))},a.setDragging=function(e){a.setState({isdragging:e})},a.setXY=function(e){a.setState({selector:e})},a.getDistance=function(e,t,a,n){var i=e*Math.PI/180,o=a*Math.PI/180,s=(a-e)*Math.PI/180,r=(n-t)*Math.PI/180,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(i)*Math.cos(o)*Math.sin(r/2)*Math.sin(r/2);return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},a.getBoundArea=function(e,t,n,i){return a.getDistance(e,n,e,i)*a.getDistance(e,n,t,n)},a.state={viewport:{width:"100%",height:"600px",latitude:48.1358,longitude:11.5611,zoom:15},selector:{x:0,y:0},isdragging:!1,selBounds:{n:0,s:0,w:0,e:0},width:0},a.mapRef=i.a.createRef(),a}return Object(u.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.resize),this.resize();var e=this.mapRef.current.getMap().getBounds();this.setState({selBounds:{n:e._ne.lat,s:e._sw.lat,w:e._sw.lng,e:e._ne.lng},selector:{x:.9*window.innerWidth/4,y:150}})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resize)}},{key:"render",value:function(){var e=this.state,t=e.viewport,a=e.selector,n=e.selBounds,o=n.n-a.y/600*(n.n-n.s),s=n.s+a.y/600*(n.n-n.s),r=n.w+a.x/this.state.width*(n.e-n.w),l=n.e-a.x/this.state.width*(n.e-n.w),c=this.getBoundArea(o,s,r,l).toFixed(2),p=this.props.location.pathname==="".concat("/infomap","/demo");return i.a.createElement("div",null,i.a.createElement(b.default,Object.assign({className:"map",ref:this.mapRef},t,{onViewportChange:this.handleViewportChange,mapboxApiAccessToken:N,mapStyle:"mapbox://styles/mapbox/streets-v9"}),i.a.createElement(w.a,{mapRef:this.mapRef,onResult:this.handleOnResult,onViewportChange:this.handleGeocoderViewportChange,mapboxApiAccessToken:N,position:"top-left"}),i.a.createElement("div",{className:"control"},i.a.createElement(b.NavigationControl,{showCompass:!1,onViewportChange:this.handleViewportChange})),i.a.createElement(k,Object.assign({},a,{setDragging:this.setDragging,setXY:this.setXY}))),c<=5e6?i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"area-indicator"},i.a.createElement("div",{className:"area-indicator-fill",style:{width:c/5e6*200}})),i.a.createElement("div",{className:"area-number"},"Area: ",c," m \xb2"),p?i.a.createElement(m.a,{to:"".concat("/infomap","/demo/selected")},i.a.createElement("div",{className:"button proceed-button"},"Proceed to Analysis ")):i.a.createElement(m.a,{to:"".concat("/infomap","/selected/").concat(r,"/").concat(s,"/").concat(l,"/").concat(o)},i.a.createElement("div",{className:"button proceed-button"},"Proceed to Analysis ")),i.a.createElement("div",{className:"proceed-alert green"}," You can use this selected region. ")):i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"area-indicator"},i.a.createElement("div",{className:"area-indicator-fill area-exceed",style:{width:200}})),i.a.createElement("div",{className:"area-number"},"Area: >5 km \xb2"),i.a.createElement("div",{className:"button button-disabled proceed-button"},"Proceed to Analysis "),i.a.createElement("div",{className:"proceed-alert red"}," Area of the selected region is too big. ")),i.a.createElement("div",{className:"clearfix"}),p?i.a.createElement("div",null):i.a.createElement("div",{className:"raw"},i.a.createElement("div",null,i.a.createElement("p",null,"Viewport Coordinates:"),i.a.createElement("p",null," ","n: ".concat(n.n," s: ").concat(n.s," w: ").concat(n.w," e: ").concat(n.e))),i.a.createElement("div",null,i.a.createElement("p",null,"Selected Region Coordinates:"),i.a.createElement("p",null," ","n: ".concat(o," s: ").concat(s," w: ").concat(r," e: ").concat(l))),i.a.createElement("div",null,i.a.createElement("p",null,"Selected Region Area:"),i.a.createElement("p",null," ",c))))}}]),t}(n.Component),j=Object(E.a)(M),x=function(e){function t(){return Object(c.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{className:"content-wrapper"},i.a.createElement("div",{className:"title"},"Select an Area"),i.a.createElement(j,null))}}]),t}(i.a.Component),S=function(e){function t(){return Object(c.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",null,"Help"))}}]),t}(i.a.Component),C=function(e){function t(){return Object(c.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",null,"About"))}}]),t}(i.a.Component),_=a(137),D=a.n(_),T=(a(216),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).getBuildingCat=function(e){var t=5;return[["apartments","farm","hotel","house","detached","residential","dormitory","terrace","houseboat","bungalow","static_caravan","cabin"],["commercial","office","industrial","retail","supermarket","warehouse","kiosk"],["religious","cathedral","chapel","church","mosque","temple","synagogue","shrine"],["bakehouse","kindergarten","civic","government","hospital","school","stadium","train_station","transportation","university","grandstand","public","toilets","service","parking","garages","garage","sports_hall","bridge","\tcarport","hangar"],["greenhouse","pavilion","farm_auxiliary","barn"]].forEach(function(a,n){-1!==a.indexOf(e)&&(t=n)}),t},a.showTooltip=function(e,t){var n=t.target.getBBox();n.x+n.width/2>=a.props.width/2?a.setState({left:!0}):a.setState({left:!1}),a.setState({tooltip:!0,info:e})},a.hideTooltip=function(){a.setState({tooltip:!1,info:{}})},a.state={tooltip:!1,info:{},left:!0},a}return Object(u.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=[],t=this.props,a=t.width,n=t.height,o=(t.nodes,t.ways),s=t.relations,r=this.state.info,l=[{fill:"#ad4a00"},{fill:"#7693d3"},{fill:"#0053cc"},{fill:"#cb00d1"},{fill:"#b6ff97"},{fill:"rgba(60, 60, 60)"}],c=-1,p=null,d="rgba(60, 60, 60)";for(var h in s)if(s[h].tag.building||s[h].tag["buidling:part"]){var u="";d="rgba(60,60,60)",s[h].members.forEach(function(e){if("way"===e.type&&e.value){var t=e.value.map(function(e){return e.join(",")}).join(" ");u+="M ".concat(t)}}),"Height"===this.props.option?(p=s[h].tag["building:levels"])?(d="rgba(0,0,255,".concat(p/10,")"),e.push(i.a.createElement("path",{d:u,fillRule:"evenodd",fill:d,stroke:"white",strokeWidth:".5",key:h,className:"nolli-building",onMouseOver:this.showTooltip.bind(this,s[h].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,h)))):e.unshift(i.a.createElement("path",{d:u,fillRule:"evenodd",fill:d,stroke:"white",strokeWidth:".5",key:h,className:"nolli-building",onMouseOver:this.showTooltip.bind(this,s[h].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,h))):"Program"===this.props.option?(c=this.getBuildingCat(s[h].tag.building),e.push(i.a.createElement("path",{d:u,fillRule:"evenodd",fill:l[c].fill,stroke:"white",strokeWidth:".5",key:h,className:"nolli-building",onMouseOver:this.showTooltip.bind(this,s[h].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,h)))):"None"===this.props.option&&e.push(i.a.createElement("path",{d:u,fillRule:"evenodd",fill:d,stroke:"white",strokeWidth:".5",key:h,className:"nolli-building",onMouseOver:this.showTooltip.bind(this,s[h].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,h)))}else if((s[h].tag.leisure||"grass"===s[h].tag.landuse)&&"Program"===this.props.option){u="";s[h].members.forEach(function(e){if("way"===e.type&&e.value){var t=e.value.map(function(e){return e.join(",")}).join(" ");u+="M ".concat(t)}}),e.push(i.a.createElement("path",{d:u,fillRule:"evenodd",fill:l[4].fill,stroke:"white",strokeWidth:".5",key:h,className:"nolli-building",onMouseOver:this.showTooltip.bind(this,s[h].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,h)))}for(h in o)if(o[h].tag.building){var m=o[h].points.map(function(e){return e.join(",")}).join(" ");d="rgba(60,60,60)","Height"===this.props.option?(p=o[h].tag["building:levels"])?(d="rgba(0,0,255,".concat(p/10,")"),e.push(i.a.createElement("polygon",{points:m,fill:d,stroke:"white",strokeWidth:".5",key:h,className:"nolli-building",onMouseOver:this.showTooltip.bind(this,o[h].tag),onMouseLeave:this.hideTooltip.bind(this)}))):e.unshift(i.a.createElement("polygon",{points:m,fill:d,stroke:"white",strokeWidth:".5",key:h,className:"nolli-building",onMouseOver:this.showTooltip.bind(this,o[h].tag),onMouseLeave:this.hideTooltip.bind(this)})):"Program"===this.props.option?(c=this.getBuildingCat(o[h].tag.building),e.push(i.a.createElement("polygon",{points:m,fill:l[c].fill,stroke:"white",strokeWidth:".5",key:h,className:"nolli-building",onMouseOver:this.showTooltip.bind(this,o[h].tag),onMouseLeave:this.hideTooltip.bind(this)}))):"None"===this.props.option&&e.push(i.a.createElement("polygon",{points:m,fill:d,stroke:"white",strokeWidth:".5",key:h,className:"nolli-building",onMouseOver:this.showTooltip.bind(this,o[h].tag),onMouseLeave:this.hideTooltip.bind(this)}))}else if((o[h].tag.leisure||"grass"===o[h].tag.landuse)&&"Program"===this.props.option){m=o[h].points.map(function(e){return e.join(",")}).join(" ");e.push(i.a.createElement("polygon",{points:m,fill:l[4].fill,stroke:"white",strokeWidth:".5",key:h,className:"nolli-building",onMouseOver:this.showTooltip.bind(this,o[h].tag),onMouseLeave:this.hideTooltip.bind(this)}))}var g=[];for(var f in r)if("building"!==f||"yes"!==r[f]){var v=f.charAt(0).toUpperCase()+f.substr(1).toLowerCase();g.push(i.a.createElement("div",{className:"tooltip-info",key:f},i.a.createElement("span",{className:"tooltip-key"},v,": "),r[f]," ","Footprint"===v?decodeURI("m%C2%B2"):""))}var b={};return b=this.state.left?{top:"0",left:"0"}:{top:"0",right:"0"},console.log("rerender!"),i.a.createElement("div",{className:"nollimap"},i.a.createElement("svg",{version:"1.1",viewBox:"0 0 ".concat(a," ").concat(n),style:{width:this.state.width}},e),i.a.createElement("div",{className:this.state.tooltip?"tooltip":"hide",style:b},i.a.createElement("div",{className:"tooltip-title"},"Building Details"),g))}}]),t}(i.a.Component)),W=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).showTooltip=function(e,t){var n=t.target.getBBox();n.x+n.width/2>=a.props.width/2?a.setState({left:!0}):a.setState({left:!1}),a.setState({tooltip:!0,info:e})},a.hideTooltip=function(){a.setState({tooltip:!1,info:{}})},a.getWayCat=function(e){var t=5;return[["motorway","trunk","motorway_link","trunk_link"],["primary","primary_link"],["secondary","tertiary","secondary_link","tertiary_link","raceway"],["unclassified","residential","living_street","road","escape"],["service","pedestrian","track","bus_guideway","footway","bridleway","steps","path","cycleway"]].forEach(function(a,n){-1!==a.indexOf(e)&&(t=n)}),t},a.state={tooltip:!1,info:{},left:!0},a}return Object(u.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this,t=[[],[],[],[],[],[]],a=this.props,n=a.width,o=a.height,s=(a.nodes,a.ways),r=a.relations,l=this.state.info,c=[{color:"#b5451a",strokeWidth:"8"},{color:"#f15c22",strokeWidth:"6"},{color:"#f47d4e",strokeWidth:"6"},{color:"#f79d7a",strokeWidth:"4"},{color:"#f9bea7",strokeWidth:"3"},{color:"#fcded3",strokeWidth:"4"}],p=-1,d={};for(var h in s)if(s[h].tag.highway&&("Roads"===this.props.option||"Both"===this.props.option)){var u=s[h].points.map(function(e){return e.join(",")}).join(" ");d=c[p=this.getWayCat(s[h].tag.highway)],t[5-p].push(i.a.createElement("path",{d:"M ".concat(u),fill:"none",stroke:d.color,strokeWidth:d.strokeWidth,strokeLinecap:"round",strokeLinejoin:"round",key:h+"w",onMouseOver:this.showTooltip.bind(this,s[h].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,h)))}for(h in r)if(!r[h].tag.route||"Public Transport"!==this.props.option&&"Both"!==this.props.option){if(r[h].tag.highway&&("Roads"===this.props.option||"Both"===this.props.option)){var m="";r[h].members.forEach(function(e){if("way"===e.type&&e.value){var t=e.value.map(function(e){return e.join(",")}).join(" ");m+="M ".concat(t)}}),d=c[p=this.getWayCat(r[h].tag.highway)],t[5-p].push(i.a.createElement("path",{d:m,fillRule:"evenodd",fill:d.color,stroke:"none",key:h,className:"nolli-building",onMouseOver:this.showTooltip.bind(this,r[h].tag),onMouseLeave:this.hideTooltip.bind(this)},i.a.createElement("title",null,h)))}}else r[h].members.forEach(function(a,n){if("way"===a.type&&a.value){var o=a.value.map(function(e){return e.join(",")}).join(" ");t.push(i.a.createElement("path",{d:"M ".concat(o),fill:"none",stroke:"red",strokeWidth:"1",key:n.toString()+h,onMouseOver:e.showTooltip.bind(e,r[h].tag),onMouseLeave:e.hideTooltip.bind(e)},i.a.createElement("title",null,h)))}else if("node"===a.type&&a.value){var s=20;"subway"!==r[h].tag.route&&"train"!==r[h].tag.route||(s=40),t.push(i.a.createElement("g",{key:n.toString()+h},i.a.createElement("circle",{cx:a.value[0],cy:a.value[1],r:s,fill:"rgba(255,90,90,.2)",onMouseOver:e.showTooltip.bind(e,r[h].tag),onMouseLeave:e.hideTooltip.bind(e)},i.a.createElement("title",null,h)),i.a.createElement("circle",{cx:a.value[0],cy:a.value[1],r:"2",fill:"#803535",onMouseOver:e.showTooltip.bind(e,r[h].tag),onMouseLeave:e.hideTooltip.bind(e)},i.a.createElement("title",null,h))))}});var g=[];for(var f in l){var v=f.charAt(0).toUpperCase()+f.substr(1).toLowerCase();g.push(i.a.createElement("div",{className:"tooltip-info",key:f},i.a.createElement("span",{className:"tooltip-key"},v,": "),l[f]," ","Footprint"===v?decodeURI("m%C2%B2"):""))}var b={};return b=this.state.left?{top:"0",left:"0"}:{top:"0",right:"0"},i.a.createElement("div",{className:"nollimap"},i.a.createElement("svg",{version:"1.1",viewBox:"0 0 ".concat(n," ").concat(o),style:{width:this.state.width}},t),i.a.createElement("div",{className:this.state.tooltip?"tooltip":"hide",style:b},i.a.createElement("div",{className:"tooltip-title"},"Building Details"),g))}}]),t}(i.a.Component),L=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(h.a)(t).call(this,e))).getDistance=function(e,t,a,n){var i=e*Math.PI/180,o=a*Math.PI/180,s=(a-e)*Math.PI/180,r=(n-t)*Math.PI/180,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(i)*Math.cos(o)*Math.sin(r/2)*Math.sin(r/2);return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))},n.getDirDistance=function(e,t,a,i){return a<=e&&i>=t?n.getDistance(e,t,a,i):-n.getDistance(e,t,a,i)},n.getBoundArea=function(e,t,a,i){return n.getDistance(e,a,e,i)*n.getDistance(e,a,t,a)},n.checkSingle=function(e){return Array.isArray(e)?e:e?[e]:[]},n.getWayPoints=function(e){var t="";return e.forEach(function(e){t+="".concat(e.x,",").concat(e.y," ")}),t},n.mapPix=function(e,t,a,n,i){return n+(e-t)*(i-n)/(a-t)},n.addLoading=function(e){n.setState({loading:n.state.loading+e})},n.resetLoading=function(){n.setState({loading:0})},n.updateStates=function(){var e=n.props,t=e.nlat,i=e.slat,o=e.wlng,s=e.elng,r=e.rawdata,l=n.state.width,c=l/n.getDistance(t,o,t,s),p=n.getDistance(t,o,i,o)*c,d={},h={},u={};if(r){var m=a(219).xml2js(r,{compact:!0,spaces:4}),g=n.checkSingle(m.osm.node),f=n.checkSingle(m.osm.way),v=n.checkSingle(m.osm.relation);g.forEach(function(e){var a=e._attributes.id,r=n.checkSingle(e.tag);d[a]={element:e},d[a].x=n.mapPix(e._attributes.lon,o,s,0,l),d[a].y=n.mapPix(e._attributes.lat,t,i,0,p),d[a].tag={},r.forEach(function(e){d[a].tag[e._attributes.k]=e._attributes.v})}),f.forEach(function(e){var t=e._attributes.id,a=n.checkSingle(e.nd),i=n.checkSingle(e.tag);if(h[t]={element:e},h[t].children=[],h[t].points=[],h[t].tag={},a.forEach(function(e){h[t].children.push(d[e._attributes.ref]),h[t].points.push([d[e._attributes.ref].x,d[e._attributes.ref].y])}),i.forEach(function(e){h[t].tag[e._attributes.k]=e._attributes.v}),h[t].tag.building){var o=n.getArea(h[t].points)/c/c;h[t].footprint=o,h[t].tag.footprint=o.toFixed(2)}}),v.forEach(function(e){var t=e._attributes.id,a=n.checkSingle(e.member),i=n.checkSingle(e.tag);if(u[t]={element:e},u[t].children=[],u[t].members=[],u[t].tag={},a.forEach(function(e){u[t].children.push(h[e._attributes.ref]),"way"===e._attributes.type&&h[e._attributes.ref]?u[t].members.push({type:"way",value:h[e._attributes.ref].points,role:e._attributes.role}):"node"===e._attributes.type&&d[e._attributes.ref]?u[t].members.push({type:"node",value:[d[e._attributes.ref].x,d[e._attributes.ref].y],role:e._attributes.role}):"relation"===e._attributes.type&&u[e._attributes.ref]&&u[t].members.push({type:"relation",value:u[e._attributes.ref].members,role:e._attributes.role})}),i.forEach(function(e){u[t].tag[e._attributes.k]=e._attributes.v}),u[t].tag.building||u[t].tag["buidling:part"]){var o=0;u[t].members.forEach(function(e){"outer"===e.role?o+=n.getArea(e.value):"outer"===e.role&&(o-=n.getArea(e.value))}),o=o/c/c,u[t].footprint=o,u[t].tag.footprint=o.toFixed(2)}}),n.addLoading(100)}n.setState({height:p,nodes:d,ways:h,relations:u}),console.log(d),console.log(h),console.log(u),console.log(c)},n.getOptions=function(){var e=a(237)[n.props.selected],t=n.state.options[n.props.selected],o=[];return e&&(o.push(i.a.createElement("div",{className:"options-title",key:"title"},e.title)),e.options.forEach(function(e){o.push(i.a.createElement("div",{className:e===t?"options-item-selected":"options-item",onClick:function(){n.setOption(e)},key:e},e))})),o},n.setOption=function(e){var t=n.state.options;t[n.props.selected]=e,n.setState({options:t}),console.log("reset!")},n.state={loading:0,width:1e3,height:0,nodes:{},ways:{},relations:{},options:{"Nolli Map":"None",Traffic:"Both"}},n}return Object(u.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.updateStates()}},{key:"componentDidUpdate",value:function(e){this.props.rawdata!==e.rawdata&&(this.resetLoading(),this.updateStates())}},{key:"getArea",value:function(e){var t=e,a=0;if(t.length<3)return 0;for(var n=0;n<t.length-1;n+=1)a+=t[n][0]*t[n+1][1]-t[n+1][0]*t[n][1];return Math.abs(1*a/2)}},{key:"render",value:function(){console.log(this.state.options);var e=this.getOptions(),t=this.state,a=t.ways,n=t.nodes,o=t.relations,s=t.width,r=t.height,l={},c=[];for(var p in l["Nolli Map"]=i.a.createElement(T,{nodes:n,ways:a,relations:o,width:s,height:r,getWayPoints:this.getWayPoints,addLoading:this.addLoading,nlat:this.props.nlat,slat:this.props.slat,wlng:this.props.wlng,elng:this.props.elng,option:this.state.options["Nolli Map"],key:"Nolli Map"}),l.Traffic=i.a.createElement(W,{nodes:n,ways:a,relations:o,width:s,height:r,getWayPoints:this.getWayPoints,addLoading:this.addLoading,nlat:this.props.nlat,slat:this.props.slat,wlng:this.props.wlng,elng:this.props.elng,key:"Traffic",option:this.state.options.Traffic}),this.props.added)this.props.added[p]&&c.unshift(l[p]);return i.a.createElement("div",{className:"maps-wrapper"},i.a.createElement("div",{className:"options"},e),i.a.createElement("svg",{version:"1.1",viewBox:"0 0 ".concat(this.state.width," ").concat(this.state.height),style:{width:this.state.width}}),i.a.createElement("div",{className:100===this.state.loading?"hide":"loading"},"Loading... "),"Overlay"===this.props.selected?c:l[this.props.selected])}}]),t}(i.a.Component),B=(a(238),a(280),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).changeMap=function(e){a.props.changeMap(e)},a.addOverlay=function(e,t){e.stopPropagation(),a.props.addOverlay(t)},a.removeOverlay=function(e,t){e.stopPropagation(),a.props.removeOverlay(t)},a.handleUpdate=function(e,t){console.log(e),console.log(t)},a.renderMenu=function(){var e=a.props,t=e.layers,n=e.added,o=e.selected,s=[];return t.forEach(function(e,t){s.push(i.a.createElement("div",{className:e===o?"menu-item selected":"menu-item",key:"".concat(e),onClick:function(){return a.changeMap(e)}},i.a.createElement("div",{className:"menu-subtitle"},e),n[e]?i.a.createElement("svg",{version:"1.1",viewBox:"0 0 80 80",className:e===o?"icon selected":"icon",onClick:function(t){return a.removeOverlay(t,e)}},i.a.createElement("path",{id:"XMLID_6_",d:"M74,45H6c-2.8,0-5-2.2-5-5s2.2-5,5-5h68c2.8,0,5,2.2,5,5S76.8,45,74,45z"})):i.a.createElement("svg",{version:"1.1",viewBox:"0 0 80 80",className:e===o?"icon selected":"icon",onClick:function(t){return a.addOverlay(t,e)}},i.a.createElement("path",{d:"M74,35H45V6c0-2.8-2.2-5-5-5s-5,2.2-5,5v29H6c-2.8,0-5,2.2-5,5c0,2.8,2.2,5,5,5h29v29c0,2.8,2.2,5,5,5s5-2.2,5-5V45h29 c2.8,0,5-2.2,5-5C79,37.2,76.8,35,74,35z"})),i.a.createElement("div",{className:"clearfix"})))}),s},a.state={menu:a.props.layers,added:a.props.added,selected:a.props.selected},a}return Object(u.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this,t=this.renderMenu();return i.a.createElement("div",{className:"menu"},i.a.createElement(m.a,{to:"".concat("/infomap","/"),className:"back"},i.a.createElement("svg",{version:"1.1",viewBox:"0 0 80 80",className:"back-icon"},i.a.createElement("path",{id:"XMLID_7_",d:"M74,35H18.1l23.5-23.5c2-2,2-5.1,0-7.1c-2-2-5.1-2-7.1,0l-32,32c0,0,0,0,0,0C2.2,36.7,2,37,1.8,37.2 c-0.1,0.1-0.1,0.3-0.2,0.4c-0.1,0.2-0.2,0.3-0.2,0.5c-0.1,0.2-0.1,0.3-0.2,0.5c0,0.1-0.1,0.3-0.1,0.4c-0.1,0.6-0.1,1.3,0,2 c0,0.1,0.1,0.3,0.1,0.4c0.1,0.2,0.1,0.3,0.2,0.5c0.1,0.2,0.2,0.3,0.2,0.5c0.1,0.1,0.1,0.3,0.2,0.4C2,43,2.2,43.3,2.5,43.5l32,32 c1,1,2.3,1.5,3.5,1.5s2.6-0.5,3.5-1.5c2-2,2-5.1,0-7.1L18.1,45H74c2.8,0,5-2.2,5-5S76.8,35,74,35z"})),i.a.createElement("div",{className:"title"},"Change Location")),i.a.createElement("div",{className:"clearfix"}),t,i.a.createElement("div",{className:"Overlay"===this.props.selected?"menu-item selected":"menu-item",onClick:function(){return e.changeMap("Overlay")}},i.a.createElement("div",{className:"menu-title"},"Overlay")))}}]),t}(i.a.Component)),P=Object(E.a)(B),A=(a(126),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).changeMap=function(e){a.setState({selected:e})},a.addOverlay=function(e){var t=a.state.added;t[e]=!0,a.setState({added:t})},a.removeOverlay=function(e){var t=a.state.added;t[e]=!1,a.setState({added:t})},a.state={raw:null,layers:["Nolli Map","Traffic"],added:{"Nolli Map":!0,Traffic:!0},selected:"Nolli Map"},a.bounds=a.props.match.params,a}return Object(u.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this;D.a.get("https://api.openstreetmap.org/api/0.6/map?bbox=".concat(this.bounds.wlng,",").concat(this.bounds.slat,",").concat(this.bounds.elng,",").concat(this.bounds.nlat)).then(function(t){t.data&&e.setState({raw:t.data})})}},{key:"render",value:function(){return i.a.createElement("div",{className:"maps"},i.a.createElement(P,{layers:this.state.layers,added:this.state.added,selected:this.state.selected,changeMap:this.changeMap,addOverlay:this.addOverlay,removeOverlay:this.removeOverlay}),i.a.createElement("div",{className:"map-display"},i.a.createElement(L,Object.assign({layers:this.state.layers,added:this.state.added,selected:this.state.selected},this.props.match.params,{rawdata:this.state.raw}))),i.a.createElement("div",{className:"clearfix"}),i.a.createElement("div",{className:"raw"},i.a.createElement("div",null,"n: ".concat(this.bounds.nlat," s: ").concat(this.bounds.slat," w: ").concat(this.bounds.wlng," e: ").concat(this.bounds.elng)),i.a.createElement("div",null,"API address: ","https://api.openstreetmap.org/api/0.6/map?bbox=".concat(this.bounds.wlng,",").concat(this.bounds.slat,",").concat(this.bounds.elng,",").concat(this.bounds.nlat))))}}]),t}(i.a.Component)),R=a(138),I=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).changeMap=function(e){a.setState({selected:e})},a.addOverlay=function(e){a.setState({overlay:[{name:e,opacity:100}].concat(Object(R.a)(a.state.overlay))})},a.removeOverlay=function(e){var t=a.state.overlay.indexOf(e),n=a.state.overlay;n.splice(t,1),a.setState({overlay:n})},a.setOverlay=function(e){console.log(e),a.setState({overlay:e})},a.getShuffled=function(e){console.log(e),a.setState({shuffled:e})},a.setOpacity=function(e,t){var n=a.state.overlay.indexOf(e);console.log(n,t);var i=a.state.overlay;i[n]={name:e.name,opacity:parseInt(t)},a.setState({overlay:i})},a.renderLayers=function(){var e=a.state.overlay,t=[];for(var n in e)t.push(i.a.createElement("img",{key:e[n].name,style:{position:"absolute",maxWidth:"100%",opacity:e[n].opacity/100},src:"".concat("/infomap","/image/demo/").concat(e[n].name,".png"),alt:"".concat(e[n].name)}));return console.log(t),t.reverse()},a.state={sidebar:["Original","Nolli Map","Program","Traffic","POI Clustering","Overlay"],overlay:[{name:"Nolli Map",opacity:100}],shuffled:[{name:"Nolli Map",opacity:100}],selected:1},a}return Object(u.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.state.sidebar[this.state.selected];return i.a.createElement("div",{className:"maps"},i.a.createElement("div",{className:"functions"},i.a.createElement(m.a,{to:"".concat("/infomap","/demo"),className:"back"},i.a.createElement("svg",{version:"1.1",viewBox:"0 0 80 80",className:"back-icon"},i.a.createElement("path",{id:"XMLID_7_",d:"M74,35H18.1l23.5-23.5c2-2,2-5.1,0-7.1c-2-2-5.1-2-7.1,0l-32,32c0,0,0,0,0,0C2.2,36.7,2,37,1.8,37.2 c-0.1,0.1-0.1,0.3-0.2,0.4c-0.1,0.2-0.2,0.3-0.2,0.5c-0.1,0.2-0.1,0.3-0.2,0.5c0,0.1-0.1,0.3-0.1,0.4c-0.1,0.6-0.1,1.3,0,2 c0,0.1,0.1,0.3,0.1,0.4c0.1,0.2,0.1,0.3,0.2,0.5c0.1,0.2,0.2,0.3,0.2,0.5c0.1,0.1,0.1,0.3,0.2,0.4C2,43,2.2,43.3,2.5,43.5l32,32 c1,1,2.3,1.5,3.5,1.5s2.6-0.5,3.5-1.5c2-2,2-5.1,0-7.1L18.1,45H74c2.8,0,5-2.2,5-5S76.8,35,74,35z"})),i.a.createElement("div",{className:"title"},"Change Location")),i.a.createElement("div",{className:"button export-button"},"Export This Mapping")),i.a.createElement("div",{className:"clearfix"}),i.a.createElement(P,Object.assign({},this.state,{changeMap:this.changeMap,addOverlay:this.addOverlay,removeOverlay:this.removeOverlay,setOverlay:this.setOverlay,setOpacity:this.setOpacity,getShuffled:this.getShuffled})),i.a.createElement("div",{className:"map-display"},"Overlay"!=e?i.a.createElement("img",{style:{position:"absolute",maxWidth:"100%"},src:"".concat("/infomap","/image/demo/").concat(e,".png"),alt:"selected"}):this.renderLayers()),i.a.createElement("div",{className:"clearfix"}))}}]),t}(i.a.Component),X=function(e){function t(){return Object(c.a)(this,t),Object(d.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(p.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.location!==e.location&&window.scrollTo(0,0)}},{key:"render",value:function(){return this.props.children}}]),t}(i.a.Component),Y=Object(E.a)(X),z=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(h.a)(t).call(this,e))).state={},a}return Object(u.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return i.a.createElement("div",{className:"footer"},i.a.createElement("div",null,"Infomap v0.1.0 prototype \xa9 2018 Wu Chenmu"))}}]),t}(i.a.Component);a(285);s.a.render(i.a.createElement(r.a,null,i.a.createElement(Y,null,i.a.createElement("div",{className:"content"},i.a.createElement(f,null),i.a.createElement(l.a,{exact:!0,path:"/infomap/",component:x}),i.a.createElement(l.a,{exact:!0,path:"/infomap/help",component:S}),i.a.createElement(l.a,{exact:!0,path:"/infomap/about",component:C}),i.a.createElement(l.a,{exact:!0,path:"/infomap/demo",component:x}),i.a.createElement(l.a,{exact:!0,path:"/infomap/selected/:wlng/:slat/:elng/:nlat",component:A}),i.a.createElement(l.a,{exact:!0,path:"/infomap/demo/selected",component:I}),i.a.createElement(z,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[139,2,1]]]);
//# sourceMappingURL=main.87cbb530.chunk.js.map